–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤—ã–π –∫–ª–∞—Å—Ç–µ—Ä PostgreSQL –Ω–∞ —Å—Ç–µ–∫–µ Patroni, etcd, HAProxy ‚Äî —ç—Ç–æ **–≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, –≥–¥–µ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –æ–±–µ—Å–ø–µ—á–µ–Ω–∞ –Ω–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**. –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏–Ω—Ü–∏–ø ‚Äî –∏–∑–±–µ–∂–∞—Ç—å –µ–¥–∏–Ω–æ–π —Ç–æ—á–∫–∏ –æ—Ç–∫–∞–∑–∞ (SPOF) –∏ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ.

–í–æ—Ç –ø–æ–ª–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–∞–∫–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è. –í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—ë –∫–∞–∫ –æ—Å–Ω–æ–≤—É –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```mermaid
flowchart TD
    subgraph "–£—Ä–æ–≤–µ–Ω—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (Load Balancer)"
        LB[HAProxy<br>–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π IP 192.168.1.10]
    end

    subgraph "–£—Ä–æ–≤–µ–Ω—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (Patroni + DCS)"
        subgraph "–ö–ª–∞—Å—Ç–µ—Ä etcd (–•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è)"
            E1[etcd Node 1]
            E2[etcd Node 2]
            E3[etcd Node 3]
        end
        E1 <--> E2
        E1 <--> E3
        E2 <--> E3
    end

    subgraph "–£—Ä–æ–≤–µ–Ω—å –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)"
        subgraph "–°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è (Streaming)"
            direction LR
            P1[<b>Primary</b><br>Node 1<br>–ß—Ç–µ–Ω–∏–µ/–ó–∞–ø–∏—Å—å] -- sync --> S1[<b>Sync Standby</b><br>Node 2<br>–¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ]
        end
        S1 -- async --> S2[<b>Async Standby</b><br>Node 3<br>–¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ]
    end

    LB -- "–ù–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã<br>–Ω–∞ —Ç–µ–∫—É—â–∏–π Primary" --> P1
    LB -- "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è /api/health" --> P1
    LB -- "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è /api/health" --> S1
    LB -- "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è /api/health" --> S2
    
    P1 -- "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è, –≤—ã–±–æ—Ä—ã –ª–∏–¥–µ—Ä–∞" --> E2
    S1 -- "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è" --> E1
    S2 -- "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è" --> E3
```

### üõ†Ô∏è –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
–¢–µ–ø–µ—Ä—å —Ä–∞–∑–±–µ—Ä–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∏–∑ —Å—Ö–µ–º—ã. –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∏–∂–µ ‚Äî —ç—Ç–æ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞–±–æ—á–∏–µ —à–∞–±–ª–æ–Ω—ã.

**1. –ö–ª–∞—Å—Ç–µ—Ä etcd (Distributed Configuration Store)**
Etcd –≤—ã—Å—Ç—É–ø–∞–µ—Ç –≤ —Ä–æ–ª–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ ¬´–º–æ–∑–≥–∞¬ª –∫–ª–∞—Å—Ç–µ—Ä–∞, —Ö—Ä–∞–Ω—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–æ–¥. –í–æ—Ç –ø—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —É–∑–ª–∞ `etcd1` (—Ñ–∞–π–ª `/etc/etcd/etcd.conf`):
```ini
ETCD_NAME="etcd1"
ETCD_LISTEN_PEER_URLS="http://192.168.1.11:2380"
ETCD_LISTEN_CLIENT_URLS="http://192.168.1.11:2379,http://127.0.0.1:2379"
ETCD_INITIAL_ADVERTISE_PEER_URLS="http://192.168.1.11:2380"
ETCD_ADVERTISE_CLIENT_URLS="http://192.168.1.11:2379"
ETCD_INITIAL_CLUSTER="etcd1=http://192.168.1.11:2380,etcd2=http://192.168.1.12:2380,etcd3=http://192.168.1.13:2380"
ETCD_INITIAL_CLUSTER_TOKEN="pg-cluster-token"
ETCD_INITIAL_CLUSTER_STATE="new"
```
*   **–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª–∞—Å—Ç–µ—Ä etcd —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ **–Ω–µ—á—ë—Ç–Ω–æ–≥–æ —á–∏—Å–ª–∞ —É–∑–ª–æ–≤** (3, 5) –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞ Raft. –í—Å–µ –∞–¥—Ä–µ—Å–∞ (`LISTEN` –∏ `ADVERTISE`) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã –º–µ–∂–¥—É —É–∑–ª–∞–º–∏.

**2. Patroni –∏ PostgreSQL**
Patroni ‚Äî —ç—Ç–æ –¥–µ–º–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º PostgreSQL, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ etcd. –í–æ—Ç —Å–æ–∫—Ä–∞—â—ë–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —É–∑–ª–∞ –ë–î (—Ñ–∞–π–ª `/etc/patroni/patroni.yml`):
```yaml
scope: pg_cluster
namespace: /service/
name: pg_node1

restapi:
    listen: 192.168.1.21:8008
    connect_address: 192.168.1.21:8008

etcd:
    hosts: 192.168.1.11:2379,192.168.1.12:2379,192.168.1.13:2379

bootstrap:
    dcs:
        ttl: 30
        loop_wait: 10
        retry_timeout: 10
        maximum_lag_on_failover: 1048576
        synchronous_mode: true
        postgresql:
            use_pg_rewind: true
            parameters:
                wal_level: replica
                hot_standby: "on"
                synchronous_commit: "on"
                synchronous_standby_names: "ANY 1 (pg_node1, pg_node2)"

postgresql:
    listen: 192.168.1.21:5432
    connect_address: 192.168.1.21:5432
    data_dir: /var/lib/postgresql/16/main
    authentication:
        replication:
            username: replicator
            password: "secure_password"
        superuser:
            username: postgres
            password: "secure_password"
```
*   **–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**:
    *   `synchronous_mode: true` –∏ `synchronous_standby_names` –≤–∫–ª—é—á–∞—é—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –Ω—É–ª–µ–≤–æ–π –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö (RPO=0).
    *   `use_pg_rewind: true` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ WAL –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ —Å—Ç–∞—Ä–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞ –≤ –∫–ª–∞—Å—Ç–µ—Ä.
    *   –£–≤–µ–ª–∏—á–∏–≤–∞–π—Ç–µ `loop_wait` –∏ `ttl` –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π failover.

**3. HAProxy (Load Balancer)**
HAProxy —Å–æ–∑–¥–∞—ë—Ç –µ–¥–∏–Ω—É—é —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞. –û–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–æ–¥ —á–µ—Ä–µ–∑ REST API Patroni (–ø–æ—Ä—Ç 8008) –∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞—Ñ–∏–∫ —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–∞—Å—Ç–µ—Ä. –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```haproxy
listen postgres_write
    bind *:5000
    mode tcp
    option httpchk GET /master
    http-check expect status 200
    default-server inter 3s fall 3 rise 2 on-marked-down shutdown-sessions
    server pg_node1 192.168.1.21:5432 maxconn 100 check port 8008
    server pg_node2 192.168.1.22:5432 maxconn 100 check port 8008
    server pg_node3 192.168.1.23:5432 maxconn 100 check port 8008
```
*   **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ HAProxy**: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **vip-manager** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º IP (Virtual IP), —á—Ç–æ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π —É–∑–µ–ª –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ –∫–∞–∫ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—É—é —Ç–æ—á–∫—É –æ—Ç–∫–∞–∑–∞.

### ‚ö†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –ø–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏
1.  **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ (Split-Brain)**: –ì–ª–∞–≤–Ω–∞—è —É–≥—Ä–æ–∑–∞ –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ etcd –∏–ª–∏ —Å–µ—Ç–∏. **–†–µ—à–µ–Ω–∏–µ**: –í—Å–µ–≥–¥–∞ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–π—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä etcd –∏–∑ 3 –∏–ª–∏ 5 —É–∑–ª–æ–≤ –Ω–∞ **–æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö**. –ù–µ —Ä–∞–∑–º–µ—â–∞–π—Ç–µ –µ–≥–æ –Ω–∞ —Ç–µ—Ö –∂–µ —Ö–æ—Å—Ç–∞—Ö, —á—Ç–æ –∏ PostgreSQL, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ –∑–∞ —Ä–µ—Å—É—Ä—Å—ã.
2.  **–õ–æ–∂–Ω—ã–π —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ failover**: –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ, –∫–æ–≥–¥–∞ Patroni –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å lease –≤ etcd. **–†–µ—à–µ–Ω–∏–µ**: –ê–∫–∫—É—Ä–∞—Ç–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ `ttl`, `loop_wait` –∏ `retry_timeout` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Patroni.
3.  **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏**: –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É. **–†–µ—à–µ–Ω–∏–µ**: –î–ª—è –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–∞ –º–µ–∂–¥—É —Å–∫–æ—Ä–æ—Å—Ç—å—é –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å—é –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `synchronous_standby_names = 'ANY 1 (...)'`, –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–∞—Å—Ç–µ—Ä—É –∂–¥–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ö–æ—Ç—è –±—ã –æ—Ç –æ–¥–Ω–æ–π –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ä–µ–ø–ª–∏–∫.

### üí¨ –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è (–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã)
1.  **–ö–∞–∫–∏–µ —Ä–æ–ª–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç etcd, Patroni –∏ HAProxy –≤ —ç—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ?**
    *   **Etcd**: –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (DCS). –•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–º, –∫–∞–∫–æ–π —É–∑–µ–ª —è–≤–ª—è–µ—Ç—Å—è –º–∞—Å—Ç–µ—Ä–æ–º, –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ–Ω—Å–µ–Ω—Å—É—Å –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–æ–≤ –Ω–æ–≤–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞.
    *   **Patroni**: –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä (–º–µ–Ω–µ–¥–∂–µ—Ä) –∫–ª–∞—Å—Ç–µ—Ä–∞. –°–ª–µ–¥–∏—Ç –∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º PostgreSQL, –æ–±—â–∞–µ—Ç—Å—è —Å etcd –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π (failover, switchover) —Å–æ–≥–ª–∞—Å–Ω–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
    *   **HAProxy**: –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏ (–∏–ª–∏ –ø—Ä–æ—Å—Ç–æ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞). –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ –Ω–æ–¥ —á–µ—Ä–µ–∑ API Patroni –∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Ç–µ–∫—É—â–µ–º—É –º–∞—Å—Ç–µ—Ä—É.

2.  **–ö–∞–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è –Ω—É–ª–µ–≤–∞—è –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö (RPO=0) –∏ –∫–∞–∫–æ–≤—ã –∫–æ–º–ø—Ä–æ–º–∏—Å—Å—ã?**
    *   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è**. –ú–∞—Å—Ç–µ—Ä —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é, —Ç–æ–ª—å–∫–æ –ø–æ–ª—É—á–∏–≤ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∏.
    *   **–ö–æ–º–ø—Ä–æ–º–∏—Å—Å**: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞ –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –∑–∞–ø–∏—Å—å (–ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å). –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∏ –º–∞—Å—Ç–µ—Ä –º–æ–∂–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å (–µ—Å–ª–∏ `synchronous_mode_strict: true`).

3.  **–ß—Ç–æ —Ç–∞–∫–æ–µ Split-Brain –∏ –∫–∞–∫ –µ–≥–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ Patroni?**
    *   **Split-Brain** ‚Äî —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –¥–≤–∞ —É–∑–ª–∞, —Å—á–∏—Ç–∞—é—â–∏—Ö —Å–µ–±—è –º–∞—Å—Ç–µ—Ä–æ–º, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö.
    *   **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ**: –ù–∞–ª–∏—á–∏–µ **–∫–≤–æ—Ä—É–º–∞ –≤ DCS (etcd)**. –¢–æ–ª—å–∫–æ —É–∑–µ–ª, —É–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π –ª–∏–∑–∏–Ω–≥ –≤ etcd, –º–æ–∂–µ—Ç –±—ã—Ç—å –º–∞—Å—Ç–µ—Ä–æ–º. –ï—Å–ª–∏ —Å–≤—è–∑—å —Å etcd –ø–æ—Ç–µ—Ä—è–Ω–∞, Patroni –ø–µ—Ä–µ–≤–µ–¥—ë—Ç PostgreSQL –≤ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ.

4.  **–ö–∞–∫–æ–≤—ã –∫–ª—é—á–µ–≤—ã–µ —ç—Ç–∞–ø—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ failover?**
    1.  Patroni –Ω–∞ –º–∞—Å—Ç–µ—Ä–µ –Ω–µ –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å —Å–≤–æ–π –∫–ª—é—á –≤ etcd (—Å–±–æ–π –Ω–æ–¥—ã, —Å–µ—Ç–∏ –∏–ª–∏ etcd).
    2.  Lease (–∞—Ä–µ–Ω–¥–∞) –∫–ª—é—á–∞ –∏—Å—Ç–µ–∫–∞–µ—Ç (–ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ `ttl`).
    3.  Patroni –Ω–∞ —Ä–µ–ø–ª–∏–∫–∞—Ö –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç, —á—Ç–æ –∫–ª—é—á –º–∞—Å—Ç–µ—Ä–∞ –æ—Å–≤–æ–±–æ–¥–∏–ª—Å—è.
    4.  –ù–∞—á–∏–Ω–∞—é—Ç—Å—è –≤—ã–±–æ—Ä—ã –Ω–æ–≤–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞ —Å —É—á–∞—Å—Ç–∏–µ–º etcd. –ö–∞–Ω–¥–∏–¥–∞—Ç–æ–º –æ–±—ã—á–Ω–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–∞–º–∞—è –∞–∫—Ç—É–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞.
    5.  –ù–æ–≤—ã–π –º–∞—Å—Ç–µ—Ä –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è, –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–ª—é—á –≤ etc–¥, –∞ HAProxy, –æ–±–Ω–∞—Ä—É–∂–∏–≤ —ç—Ç–æ —á–µ—Ä–µ–∑ health-check, –ø–µ—Ä–µ–Ω–∞
