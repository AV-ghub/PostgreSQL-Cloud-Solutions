## üõ†Ô∏è **–¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —É—Ç–∏–ª–∏—Ç–µ psql **

---

### **1. –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ psql**

#### **–ò–∑ –∫–Ω–∏–≥–∏:**
- **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL
- **–ú–æ—â–Ω—ã–µ –º–µ—Ç–∞–∫–æ–º–∞–Ω–¥—ã** (backslash commands)
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤** –∏ –ø–∞–∫–µ—Ç–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ .psqlrc**
- **–ò—Å—Ç–æ—Ä–∏—è –∫–æ–º–∞–Ω–¥** (.psql_history)

#### **–ë–∞–∑–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**
```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø—Ü–∏–∏
psql -h localhost -p 5432 -U username -d database -W

# –ö–æ—Ä–æ—Ç–∫–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:
psql database username  # –ª–æ–∫–∞–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
psql "host=localhost dbname=test user=postgres"
psql service=myservice  # —á–µ—Ä–µ–∑ service file
```

#### **–í–∞–∂–Ω—ã–µ –º–µ—Ç–∞–∫–æ–º–∞–Ω–¥—ã:**
```
\?                  # –°–ø—Ä–∞–≤–∫–∞ –ø–æ –º–µ—Ç–∞–∫–æ–º–∞–Ω–¥–∞–º
\h [–∫–æ–º–∞–Ω–¥–∞]        # –°–ø—Ä–∞–≤–∫–∞ –ø–æ SQL (–Ω–∞–ø—Ä–∏–º–µ—Ä: \h SELECT)
\q                  # –í—ã—Ö–æ–¥
\c [db] [user]      # –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
\l                  # –°–ø–∏—Å–æ–∫ –ë–î
\dt [pattern]       # –°–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü
\di                 # –°–ø–∏—Å–æ–∫ –∏–Ω–¥–µ–∫—Å–æ–≤
\dv                 # –°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π
\df                 # –°–ø–∏—Å–æ–∫ —Ñ—É–Ω–∫—Ü–∏–π
\dn                 # –°–ø–∏—Å–æ–∫ —Å—Ö–µ–º
\du                 # –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
\dp [object]        # –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
\d [object]         # –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
\d+ [object]        # –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
\watch [sec]        # –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
\g [file]           # –í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å/—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª
\gx                 # –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
\x                  # –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –≤—ã–≤–æ–¥
\i file             # –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞
\o [file]           # –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –≤—ã–≤–æ–¥ –≤ —Ñ–∞–π–ª
\set [var [value]]  # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
\unset var          # –£–¥–∞–ª–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
\echo [text]        # –í—ã–≤–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç
\prompt [var] [text]# –ó–∞–ø—Ä–æ—Å–∏—Ç—å –≤–≤–æ–¥
\timing             # –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —Ç–∞–π–º–∏–Ω–≥
```

---

### **2. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ psql**

#### **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ .psqlrc:**
```sql
-- ~/.psqlrc
\set QUIET 1
\set PROMPT1 '%[%033[1;33m%]%/%[%033[0m%]%# '
\set PROMPT2 '... '
\set COMP_KEYWORD_CASE preserve-lower
\pset null '[NULL]'
\pset border 2
\pset linestyle unicode
\pset format wrapped
\timing on
\x auto
\set QUIET 0

-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
\setenv PAGER less
\setenv LESS '-iMSx4 -FX'
```

#### **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ psql:**
```sql
-- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
\set myvar 100
\set tablename 'users'

-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
SELECT * FROM :tablename WHERE id = :myvar;

-- –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
\echo :VERSION
\echo :USER
\echo :DBNAME
\echo :HOST
\echo :PORT
```

#### **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –≤—ã–≤–æ–¥:**
```sql
-- –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –≤—ã–≤–æ–¥
\x auto  -- –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —à–∏—Ä–æ–∫–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö

-- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
\pset border 2        -- –¥–≤–æ–π–Ω–∞—è —Ä–∞–º–∫–∞
\pset linestyle unicode
\pset format wrapped  -- –ø–µ—Ä–µ–Ω–æ—Å –¥–ª–∏–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫
\pset null '[NULL]'   -- –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏–µ NULL
\pset pager always    -- –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å pager
```

---

### **3. –†–∞–±–æ—Ç–∞ —Å–æ —Å–∫—Ä–∏–ø—Ç–∞–º–∏**

#### **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL —Ñ–∞–π–ª–æ–≤:**
```bash
# –ü–∞–∫–µ—Ç–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
psql -f script.sql
psql -f script.sql -o output.txt

# –ü–µ—Ä–µ–¥–∞—á–∞ SQL —á–µ—Ä–µ–∑ stdin
echo "SELECT version();" | psql
cat script.sql | psql

# –° –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
psql -v v1=100 -v v2="'text'" -f script.sql
```

#### **–í–Ω—É—Ç—Ä–∏ psql:**
```sql
-- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
\i /path/to/script.sql

-- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
\o results.txt
SELECT * FROM large_table;
\o

-- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏
\o session.log
\set ECHO all
\i script.sql
\set ECHO none
\o
```

---

### **4. –ü–æ–ª–µ–∑–Ω—ã–µ —Ç—Ä—é–∫–∏**

#### **–ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ:**
- **Tab –¥–≤–∞–∂–¥—ã** –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —á–µ—Ä–µ–∑ `\set COMP_KEYWORD_CASE preserve-lower`

#### **–ò—Å—Ç–æ—Ä–∏—è:**
```bash
# –ü–æ–∏—Å–∫ –≤ –∏—Å—Ç–æ—Ä–∏–∏
Ctrl+R  # reverse search
\s      # –ø–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é
\s pattern  # –ø–æ–∏—Å–∫ –≤ –∏—Å—Ç–æ—Ä–∏–∏
```

#### **–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:**
```sql
-- –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
\copy (SELECT * FROM table) TO '/path/file.csv' WITH CSV HEADER

-- –ò–º–ø–æ—Ä—Ç –∏–∑ CSV
\copy table FROM '/path/file.csv' WITH CSV HEADER

-- –ü—Ä—è–º–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å–µ—Ä–≤–µ—Ä–Ω–æ–µ)
COPY table TO '/path/file.csv' WITH CSV HEADER;  -- —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

---

### **5. –û—Ç–ª–∞–¥–∫–∞ –∏ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**

#### **–ü—Ä–æ—Å–º–æ—Ç—Ä –ø–ª–∞–Ω–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤:**
```sql
-- –ü—Ä–æ—Å—Ç–æ–π EXPLAIN
EXPLAIN SELECT * FROM users WHERE active = true;

-- –° –≤—Ä–µ–º–µ–Ω–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
EXPLAIN ANALYZE SELECT * FROM users WHERE active = true;

-- –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è
EXPLAIN (ANALYZE, BUFFERS) SELECT * FROM large_table;

-- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
EXPLAIN (ANALYZE, FORMAT JSON) SELECT * FROM table;
```

#### **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤—â–∏–∫:**
```sql
-- –í–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
CREATE EXTENSION IF NOT EXISTS pg_stat_statements;

-- –¢–æ–ø –∑–∞–ø—Ä–æ—Å–æ–≤
SELECT 
    query,
    calls,
    total_time,
    mean_time,
    rows,
    100.0 * shared_blks_hit / nullif(shared_blks_hit + shared_blks_read, 0) as hit_percent
FROM pg_stat_statements 
ORDER BY mean_time DESC 
LIMIT 10;
```

---

### **6. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ**

#### **–ó–∞–¥–∞–Ω–∏–µ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .psqlrc**
```sql
-- –°–æ–∑–¥–∞–π—Ç–µ ~/.psqlrc —Å:
-- 1. –¶–≤–µ—Ç–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º —Å –∏–º–µ–Ω–µ–º –ë–î
-- 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤–∫–ª—é—á–µ–Ω–∏–µ–º timing
-- 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º \x –¥–ª—è —à–∏—Ä–æ–∫–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
-- 4. –ö–∞—Å—Ç–æ–º–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º NULL
-- 5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–æ–ª–µ–∑–Ω—ã–µ –∞–ª–∏–∞—Å—ã
```

#### **–ó–∞–¥–∞–Ω–∏–µ 2: –°–æ–∑–¥–∞–Ω–∏–µ —É—Ç–∏–ª–∏—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π**
```sql
-- –í psql —Å–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Ç–∞–±–ª–∏—Ü—ã
\set analyze_table 'SELECT \
    schemaname, \
    relname, \
    n_live_tup, \
    n_dead_tup, \
    round(100.0 * n_dead_tup / (n_live_tup + 1), 2) as dead_ratio, \
    pg_size_pretty(pg_total_relation_size(schemaname || \'.\' || relname)) as size, \
    last_autovacuum, \
    last_autoanalyze \
FROM pg_stat_user_tables \
WHERE relname LIKE \':1%\' \
ORDER BY n_live_tup DESC;'

-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
:analyze_table 'user'
```

#### **–ó–∞–¥–∞–Ω–∏–µ 3: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤**
```bash
#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
REPORT_FILE="/var/log/postgresql/daily_report_$(date +%Y%m%d).txt"

psql << EOF > $REPORT_FILE
\echo '=== DAILY POSTGRESQL REPORT ==='
\echo 'Generated: $(date)'
\echo ''
\echo '--- Database Sizes ---'
SELECT datname, pg_size_pretty(pg_database_size(datname)) as size
FROM pg_database ORDER BY pg_database_size(datname) DESC;

\echo ''
\echo '--- Top Tables by Size ---'
SELECT schemaname, relname, 
       pg_size_pretty(pg_total_relation_size(schemaname||'.'||relname)) as size
FROM pg_stat_user_tables 
ORDER BY pg_total_relation_size(schemaname||'.'||relname) DESC 
LIMIT 10;

\echo ''
\echo '--- Connection Summary ---'
SELECT datname, count(*) as connections,
       count(*) FILTER (WHERE state = 'active') as active
FROM pg_stat_activity 
WHERE backend_type = 'client backend'
GROUP BY datname;
EOF
```

---

### **üéØ –ö–ª—é—á–µ–≤—ã–µ —Ç–µ–∑–∏—Å—ã –¥–ª—è —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è:**

1. **psql - –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞** PostgreSQL
2. **–ú–µ—Ç–∞–∫–æ–º–∞–Ω–¥—ã (\–∫–æ–º–∞–Ω–¥—ã) —ç–∫–æ–Ω–æ–º—è—Ç –≤—Ä–µ–º—è** –≤ –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π —Ä–∞–±–æ—Ç–µ
3. **.psqlrc –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å** —Ä–∞–±–æ—á–µ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
4. **\copy vs COPY:** \copy —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞, COPY - –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
5. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –≤—ã–≤–æ–¥ (\x) –Ω–µ–∑–∞–º–µ–Ω–∏–º** –¥–ª—è —à–∏—Ä–æ–∫–∏—Ö —Ç–∞–±–ª–∏—Ü

---

## ‚ùì **–í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ psql:**

1. –ö–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å SQL —Å–∫—Ä–∏–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞ –∏ –∑–∞–º–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è?
2. –í —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É \copy –∏ COPY?
3. –ö–∞–∫ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–∞ –≤ —Ñ–∞–π–ª?
4. –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü?
5. –ö–∞–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∫–æ–º–∞–Ω–¥?

## ‚ùì **–û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ psql:**

### **1. –ö–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å SQL —Å–∫—Ä–∏–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞ –∏ –∑–∞–º–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è?**
```bash
# –°–ø–æ—Å–æ–± 1: –° –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º timing –≤ psql
psql -c "\timing on" -f script.sql

# –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ –º–µ—Ç–∞–∫–æ–º–∞–Ω–¥—É –≤–Ω—É—Ç—Ä–∏ psql
\i script.sql  # –µ—Å–ª–∏ —É–∂–µ –≤–∫–ª—é—á–µ–Ω \timing

# –°–ø–æ—Å–æ–± 3: –° –≤–Ω–µ—à–Ω–∏–º –∑–∞–º–µ—Ä–æ–º –≤—Ä–µ–º–µ–Ω–∏
time psql -f script.sql

# –°–ø–æ—Å–æ–± 4: –° –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
psql << EOF
\timing on
\set ECHO queries
\i script.sql
EOF
```

**–í–Ω—É—Ç—Ä–∏ .psqlrc –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:**
```sql
\timing on  # –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ—Ä—è—Ç—å –≤—Ä–µ–º—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
```

### **2. –í —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É \copy –∏ COPY?**
| –ê—Å–ø–µ–∫—Ç | `\copy` (–º–µ—Ç–∞–∫–æ–º–∞–Ω–¥–∞ psql) | `COPY` (SQL –∫–æ–º–∞–Ω–¥–∞) |
|--------|----------------------------|----------------------|
| **–ì–¥–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è** | –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ (psql) | –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (PostgreSQL) |
| **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞** | –ü—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è psql | –¢—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∞ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ `pg_read_server_files`/`pg_write_server_files` |
| **–§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞** | –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è | –°–µ—Ä–≤–µ—Ä–Ω–∞—è |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | –ú–µ–¥–ª–µ–Ω–Ω–µ–µ (–¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ) | –ë—ã—Å—Ç—Ä–µ–µ (–ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø) |
| **–§–æ—Ä–º–∞—Ç** | –¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–π/CSV | –¢–µ–∫—Å—Ç–æ–≤—ã–π, CSV, –¥–≤–æ–∏—á–Ω—ã–π |
| **–ü—Ä–∏–º–µ—Ä** | `\copy table TO 'file.csv'` | `COPY table TO '/tmp/file.csv'` |

```sql
-- –ü—Ä–∞–≤–∞ –¥–ª—è COPY (PostgreSQL 14+)
GRANT pg_read_server_files TO username;  -- –¥–ª—è —á—Ç–µ–Ω–∏—è
GRANT pg_write_server_files TO username; -- –¥–ª—è –∑–∞–ø–∏—Å–∏
```

### **3. –ö–∞–∫ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–∞ –≤ —Ñ–∞–π–ª?**
```bash
# –°–ø–æ—Å–æ–± 1: –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ psql
psql -c "SELECT * FROM table" -o output.txt

# –°–ø–æ—Å–æ–± 2: –í–Ω—É—Ç—Ä–∏ psql
\o output.txt
SELECT * FROM table;
\o  # –≤–µ—Ä–Ω—É—Ç—å –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å

# –°–ø–æ—Å–æ–± 3: –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ shell
psql -c "SELECT * FROM table" > output.txt

# –°–ø–æ—Å–æ–± 4: –í CSV
\copy (SELECT * FROM table) TO 'output.csv' WITH CSV HEADER

# –°–ø–æ—Å–æ–± 5: –° —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
\a  # –≤—ã–∫–ª—é—á–∏—Ç—å –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ
\t  # –≤—ã–∫–ª—é—á–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏
\o data.txt
SELECT id || ',' || name FROM users;
\o
\a\t  # –≤–µ—Ä–Ω—É—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```

### **4. –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü?**
```sql
-- 1. –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω–æ)
\set COMP_KEYWORD_CASE preserve-lower

-- 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ .psqlrc:
\setenv PSQL_HISTORY ~/.psql_history
\set HISTSIZE 1000
\set HISTCONTROL ignoredups

-- 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
-- –ù–∞–±–µ—Ä–∏—Ç–µ –Ω–∞—á–∞–ª–æ –∏–º–µ–Ω–∏ —Ç–∞–±–ª–∏—Ü—ã –∏ –Ω–∞–∂–º–∏—Ç–µ Tab –¥–≤–∞–∂–¥—ã
SELECT * FROM us<Tab><Tab>
-- –ü–æ–∫–∞–∂–µ—Ç: users, user_sessions, user_logs, etc.

-- 4. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
\set AUTOCOMMIT off  # –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
\set VERBOSITY verbose  # –ø–æ–¥—Ä–æ–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
```

**–†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ:**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# pgcli - –±–æ–ª–µ–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∫–ª–∏–µ–Ω—Ç —Å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º
pip install pgcli
pgcli -U postgres -d database
```

### **5. –ö–∞–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∫–æ–º–∞–Ω–¥?**
```bash
# 1. –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏
\s

# 2. –ü–æ–∏—Å–∫ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏
\s SELECT  # –ø–æ–∫–∞–∂–µ—Ç –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã SELECT

# 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤ —Ñ–∞–π–ª
\s /tmp/history.txt

# 4. –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ (—Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏)
\s -  # –æ—á–∏—Å—Ç–∏—Ç—å –±—É—Ñ–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏

# 5. –í–Ω–µ psql - —Ä–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–º –∏—Å—Ç–æ—Ä–∏–∏
grep "SELECT" ~/.psql_history | tail -20
grep -i "index" ~/.psql_history | sort | uniq

# 6. –ü–æ–∏—Å–∫ –≤ –∏—Å—Ç–æ—Ä–∏–∏ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ)
Ctrl + R  # reverse search, –∑–∞—Ç–µ–º –≤–≤–µ–¥–∏—Ç–µ —á–∞—Å—Ç—å –∫–æ–º–∞–Ω–¥—ã

# 7. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏
\set HISTSIZE 2000  # —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2000 –∫–æ–º–∞–Ω–¥
\set HISTFILE ~/.psql_history_`date +%Y%m%d`  # –µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è
```

**–ü–æ–ª–µ–∑–Ω—ã–µ –∞–ª–∏–∞—Å—ã –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏:**
```sql
-- –î–æ–±–∞–≤–∏—Ç—å –≤ .psqlrc
\set history_search '\\s :1'

-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
:history_search CREATE TABLE
```

---
