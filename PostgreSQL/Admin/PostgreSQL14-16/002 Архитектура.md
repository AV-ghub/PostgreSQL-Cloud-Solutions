## üìÅ **–ë–ª–æ–∫ 2: –§–∏–∑–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ PostgreSQL**
### **1. –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ PostgreSQL**

#### **–ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã –∏–∑ –∫–Ω–∏–≥–∏ (–≥–ª–∞–≤–∞ 2):**
- **PGDATA** (`/var/lib/postgresql/14/main/`) - –∫–æ—Ä–Ω–µ–≤–æ–π –∫–∞—Ç–∞–ª–æ–≥ –∫–ª–∞—Å—Ç–µ—Ä–∞
- **–ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
  ```
  $PGDATA/
  ‚îú‚îÄ‚îÄ base/          # –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–ø–æ OID)
  ‚îú‚îÄ‚îÄ global/        # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã (pg_database, pg_authid)
  ‚îú‚îÄ‚îÄ pg_wal/        # WAL —Ñ–∞–π–ª—ã (—Ä–∞–Ω–µ–µ pg_xlog)
  ‚îú‚îÄ‚îÄ pg_tblspc/     # –°–∏–º–ª–∏–Ω–∫–∏ –∫ tablespaces
  ‚îú‚îÄ‚îÄ postgresql.conf
  ‚îú‚îÄ‚îÄ pg_hba.conf
  ‚îî‚îÄ‚îÄ postgresql.auto.conf
  ```

#### **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ (2024):**

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:**
```bash
# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –∫–∞—Ç–∞–ª–æ–≥ –¥–∞–Ω–Ω—ã—Ö
sudo -u postgres bash
cd /var/lib/postgresql/14/main/

# –°–º–æ—Ç—Ä–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É
ls -la

# –û—Å–Ω–æ–≤–Ω—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∏:
ls -la base/      # –ö–∞–∂–¥–∞—è –ë–î - –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥ –ø–æ OID
ls -la global/    # –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (–æ–±—â–∏–µ –¥–ª—è –≤—Å–µ—Ö –ë–î)
ls -la pg_wal/    # –ñ—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–µ–Ω!)
ls -la pg_tblspc/ # –¢–∞–±–ª–∏—á–Ω—ã–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
```

#### **OID (Object Identifier) - –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

```sql
-- 1. –ù–∞—Ö–æ–¥–∏–º OID —Å–≤–æ–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
SELECT oid, datname FROM pg_database;

-- 2. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –∫–∞—Ç–∞–ª–æ–≥ –ë–î
-- –ï—Å–ª–∏ OID=16384, —Ç–æ –∫–∞—Ç–∞–ª–æ–≥: /var/lib/postgresql/14/main/base/16384/

-- 3. –ù–∞—Ö–æ–¥–∏–º OID —Ç–∞–±–ª–∏—Ü—ã
SELECT oid, relname, relfilenode 
FROM pg_class 
WHERE relname = 'your_table';

-- 4. –§–∞–π–ª—ã —Ç–∞–±–ª–∏—Ü—ã (–≤ –∫–∞—Ç–∞–ª–æ–≥–µ –ë–î):
-- 16384      - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –¥–∞–Ω–Ω—ã—Ö
-- 16384_fsm  - –∫–∞—Ä—Ç–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
-- 16384_vm   - –∫–∞—Ä—Ç–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏ (–¥–ª—è VACUUM)
```

#### **–†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤ –∏ —Å–µ–≥–º–µ–Ω—Ç–æ–≤:**
```sql
-- –¢–∞–±–ª–∏—Ü–∞ –º–æ–∂–µ—Ç —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ (—Å–µ–≥–º–µ–Ω—Ç–æ–≤)
-- –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª –º–∞–∫—Å–∏–º—É–º 1GB
-- –ü–æ—Å–ª–µ 1GB: 16384.1, 16384.2, etc.

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–≥–º–µ–Ω—Ç–æ–≤
SELECT pg_relation_filepath('large_table');
```

---

### **2. Tablespaces (–¢–∞–±–ª–∏—á–Ω—ã–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞)**

#### **–ò–∑ –∫–Ω–∏–≥–∏:**
- **Tablespace** = –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
- **–ú–æ–∂–Ω–æ —Ä–∞–∑–º–µ—â–∞—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –¥–∏—Å–∫–∞—Ö/RAID**
- **–¢—Ä–∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö tablespace –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
  1. `pg_default` - –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
  2. `pg_global` - –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
  3. `pg_tblspc/` - —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ tablespaces

#### **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**

**–°–æ–∑–¥–∞–Ω–∏–µ tablespace:**
```sql
-- 1. –°–æ–∑–¥–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥ (–æ—Ç root –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è postgres)
sudo mkdir /opt/postgres_data
sudo chown postgres:postgres /opt/postgres_data

-- 2. –°–æ–∑–¥–∞–µ–º tablespace
CREATE TABLESPACE fast_ssd 
LOCATION '/opt/postgres_data';

-- 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º
SELECT * FROM pg_tablespace;
\db  -- –≤ psql
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ tablespace:**
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –ë–î –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º tablespace
CREATE DATABASE app_db 
TABLESPACE fast_ssd;

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º tablespace
CREATE TABLE logs (
    id BIGSERIAL PRIMARY KEY,
    log_data JSONB
) TABLESPACE fast_ssd;

-- –ü–µ—Ä–µ–Ω–æ—Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü—ã
ALTER TABLE existing_table 
SET TABLESPACE fast_ssd;
-- –í–ù–ò–ú–ê–ù–ò–ï: –ë–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É –Ω–∞ –≤—Ä–µ–º—è –ø–µ—Ä–µ–Ω–æ—Å–∞!
```

#### **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –¥–ª—è tablespaces:**

**–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è:**
```sql
-- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø—É –¥–∞–Ω–Ω—ã—Ö/–Ω–∞–≥—Ä—É–∑–∫–µ
CREATE TABLESPACE idx_ssd LOCATION '/ssd/indices';
CREATE TABLESPACE data_hdd LOCATION '/hdd/data';
CREATE TABLESPACE archive LOCATION '/archive/slow';

-- –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    data JSONB
) TABLESPACE data_hdd;

CREATE INDEX idx_orders_date ON orders(created_at) 
TABLESPACE idx_ssd;
```

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```sql
-- –†–∞–∑–º–µ—Ä tablespace
SELECT 
    spcname,
    pg_size_pretty(pg_tablespace_size(spcname)) as size
FROM pg_tablespace;

-- –ö–∞–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã –≤ tablespace
SELECT 
    ts.spcname,
    c.relname,
    c.relkind,
    pg_size_pretty(pg_relation_size(c.oid)) as size
FROM pg_class c
JOIN pg_tablespace ts ON c.reltablespace = ts.oid
WHERE ts.spcname NOT IN ('pg_default', 'pg_global')
ORDER BY pg_relation_size(c.oid) DESC;
```

---

### **3. TOAST (The Oversized-Attribute Storage Technique)**

#### **–ò–∑ –∫–Ω–∏–≥–∏:**
- **TOAST** - –º–µ—Ö–∞–Ω–∏–∑–º —Ö—Ä–∞–Ω–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π (> 2KB)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** —Ä–∞–∑–±–∏–≤–∞–µ—Ç –±–æ–ª—å—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –∫—É—Å–∫–∏
- **–•—Ä–∞–Ω–∏—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ** (`pg_toast`)
- **–ß–µ—Ç—ã—Ä–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:**
  1. **plain** - –±–µ–∑ —Å–∂–∞—Ç–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö —Ç–∏–ø–æ–≤)
  2. **extended** - —Å–∂–∞—Ç–∏–µ + out-of-line (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  3. **external** - out-of-line –±–µ–∑ —Å–∂–∞—Ç–∏—è
  4. **main** - in-line –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ, –∏–Ω–∞—á–µ out-of-line

#### **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ —Å TOAST:**

**–ü—Ä–æ–≤–µ—Ä–∫–∞ TOAST –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã:**
```sql
-- –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É —Å –±–æ–ª—å—à–∏–º–∏ –ø–æ–ª—è–º–∏
CREATE TABLE documents (
    id SERIAL PRIMARY KEY,
    small_text TEXT,
    large_text TEXT,
    json_data JSONB,
    binary_data BYTEA
);

-- –°–º–æ—Ç—Ä–∏–º TOAST –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
SELECT 
    relname,
    reltoastrelid,
    reltoastidxid,
    reloptions
FROM pg_class 
WHERE relname = 'documents';

-- –†–∞–∑–º–µ—Ä TOAST
SELECT 
    pg_size_pretty(pg_total_relation_size('documents')) as total,
    pg_size_pretty(pg_relation_size('documents')) as table_only,
    pg_size_pretty(pg_total_relation_size('documents') - 
                   pg_relation_size('documents')) as toast_size;
```

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ TOAST —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏:**
```sql
-- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è —Å—Ç–æ–ª–±—Ü–∞
ALTER TABLE documents 
ALTER COLUMN large_text 
SET STORAGE EXTERNAL;  -- –ë–µ–∑ —Å–∂–∞—Ç–∏—è, –±—ã—Å—Ç—Ä–æ

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å —è–≤–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π
CREATE TABLE images (
    id SERIAL PRIMARY KEY,
    image_data BYTEA,
    metadata JSONB
) WITH (
    toast_tuple_target = 128  # –ë–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ TOAST
);

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
SELECT 
    attname,
    atttypid::regtype,
    CASE attstorage
        WHEN 'p' THEN 'plain'
        WHEN 'e' THEN 'extended'
        WHEN 'm' THEN 'main'
        WHEN 'x' THEN 'external'
    END as storage
FROM pg_attribute
WHERE attrelid = 'documents'::regclass
AND attnum > 0;
```

---

### **4. –ü—Ä–æ—Ü–µ—Å—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**

#### **–ò–∑ –∫–Ω–∏–≥–∏:**
**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã:**
1. **Postmaster** (—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π) - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
2. **Backend processes** - –ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
3. **Background processes:**
   - **checkpointer** - –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≥—Ä—è–∑–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   - **bgwriter** - —Ñ–æ–Ω–æ–≤—ã–π writer
   - **wal writer** - –ø–∏—à–µ—Ç WAL
   - **autovacuum launcher/workers** - –æ—á–∏—Å—Ç–∫–∞
   - **stats collector** - —Å–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

#### **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
```bash
# Linux: —Å–º–æ—Ç—Ä–∏–º –ø—Ä–æ—Ü–µ—Å—Å—ã PostgreSQL
ps aux | grep postgres

# –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
# postgres: logger process
# postgres: checkpointer process
# postgres: background writer process
# postgres: walwriter process
# postgres: autovacuum launcher process
# postgres: stats collector process
# postgres: postgres postgres [local] idle
# ... –∏ backend –ø—Ä–æ—Ü–µ—Å—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ SQL:**
```sql
-- –ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
SELECT 
    pid,
    usename,
    application_name,
    client_addr,
    state,
    query,
    backend_type
FROM pg_stat_activity
WHERE backend_type != 'client backend'
ORDER BY backend_type;

-- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –ø—Ä–æ—Ü–µ—Å—Å–∞–º
SELECT 
    pid,
    name,
    setting,
    unit
FROM pg_settings 
WHERE name LIKE '%process%'
OR name LIKE '%worker%';
```

---

### **5. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ**

#### **–ó–∞–¥–∞–Ω–∏–µ 1: –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã**
```bash
# 1. –ù–∞–π–¥–∏—Ç–µ PGDATA
sudo -u postgres psql -c "SHOW data_directory;"

# 2. –ò–∑—É—á–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É
sudo ls -la $(sudo -u postgres psql -t -c "SHOW data_directory;")

# 3. –ù–∞–π–¥–∏—Ç–µ —Ñ–∞–π–ª—ã —Å–≤–æ–µ–π —Ç–µ—Å—Ç–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã
sudo -u postgres psql -c "
SELECT pg_relation_filepath('test_table');
"
```

#### **–ó–∞–¥–∞–Ω–∏–µ 2: –†–∞–±–æ—Ç–∞ —Å Tablespaces**
```sql
-- 1. –°–æ–∑–¥–∞–π—Ç–µ tablespace –Ω–∞ –±—ã—Å—Ç—Ä–æ–º –¥–∏—Å–∫–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
-- 2. –ü–µ—Ä–µ–Ω–µ—Å–∏—Ç–µ –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—É—é —Ç–∞–±–ª–∏—Ü—É
-- 3. –°–æ–∑–¥–∞–π—Ç–µ –∏–Ω–¥–µ–∫—Å –≤ –¥—Ä—É–≥–æ–º tablespace
-- 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
EXPLAIN ANALYZE SELECT * FROM large_table WHERE id = 12345;
```

#### **–ó–∞–¥–∞–Ω–∏–µ 3: –ê–Ω–∞–ª–∏–∑ TOAST**
```sql
-- 1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É —Å –±–æ–ª—å—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
CREATE TABLE test_toast AS
SELECT 
    generate_series(1, 10000) as id,
    repeat('very large text ', 1000) as large_text;

-- 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä –¥–æ –∏ –ø–æ—Å–ª–µ —Å–∂–∞—Ç–∏—è
SELECT 
    pg_size_pretty(pg_total_relation_size('test_toast')) as total,
    pg_size_pretty(pg_relation_size('test_toast')) as heap,
    pg_size_pretty(pg_total_relation_size('test_toast') - 
                   pg_relation_size('test_toast')) as toast;
```

---

### **6. –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è**

| –ü—Ä–æ–±–ª–µ–º–∞ | –°–∏–º–ø—Ç–æ–º—ã | –†–µ—à–µ–Ω–∏–µ |
|----------|----------|---------|
| **–ó–∞–∫–æ–Ω—á–∏–ª–æ—Å—å –º–µ—Å—Ç–æ –≤ PGDATA** | –û—à–∏–±–∫–∏ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ | –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ, –¥–æ–±–∞–≤–∏—Ç—å tablespace |
| **–ú–µ–¥–ª–µ–Ω–Ω—ã–π ALTER TABLE SET TABLESPACE** | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ –¥–æ–ª–≥–æ–µ –≤—Ä–µ–º—è | –î–µ–ª–∞—Ç—å –≤ downtime, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å pg_repack |
| **–ë–æ–ª—å—à–∏–µ TOAST —Ç–∞–±–ª–∏—Ü—ã** | –ú–µ–¥–ª–µ–Ω–Ω—ã–µ SELECT * | –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SELECT *, –≤—ã–±–∏—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è |
| **–ú–Ω–æ–≥–æ –º–µ–ª–∫–∏—Ö —Ñ–∞–π–ª–æ–≤** | –ú–µ–¥–ª–µ–Ω–Ω—ã–µ backup/restore | –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å partitioning –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü |

---

### **üéØ –ö–ª—é—á–µ–≤—ã–µ —Ç–µ–∑–∏—Å—ã –¥–ª—è —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è:**

1. **PGDATA —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞** - –ø–æ–Ω–∏–º–∞—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞
2. **Tablespaces - –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏** –ø–æ —Ä–∞–∑–Ω—ã–º –¥–∏—Å–∫–∞–º
3. **TOAST –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –±–æ–ª—å—à–∏–µ –¥–∞–Ω–Ω—ã–µ** (>2KB)
4. **OID vs relfilenode** - OID –ø–æ—Å—Ç–æ—è–Ω–µ–Ω, relfilenode –º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–∏
5. **–ö–∞–∂–¥–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ = –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å** (–Ω–µ thread!)

---

## ‚ùì **–í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏:**

1. –ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `global/` –∏ –ø–æ—á–µ–º—É –æ–Ω –æ—Ç–¥–µ–ª—å–Ω–æ?
2. –ö–∞–∫ –Ω–∞–π—Ç–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —Ñ–∞–π–ª —Ç–∞–±–ª–∏—Ü—ã –ø–æ –µ–µ –∏–º–µ–Ω–∏?
3. –í —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É `pg_default` –∏ `pg_global` tablespace?
4. –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ tablespaces?
5. –ö–∞–∫ TOAST –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å SELECT *?
