## Общие замечания
К основным чертам функциональности основной базы данных можно отнести следующие кейсы.
### Процесс импорта данных
Исторически данные импортировались сервисом записи методом **курсорной вставки**.
Т.е. сервис, сформировав законченную интеракцию, передавал ее параметрами в процедуру сохранения.
Что в итоге соответсствовало одной физической записи в базе, с соответствующими ее связями.

Развитие системы потребовало **интеграции с внешними сервисами** для обогащения исходных данных.
Мы получили массовый импорт, но в отложенном, асинхронном виде и в параллельные структуры данных.

Разработка сервиса чатов в масштабах федерального сервиса повлекла за собой необходимость массового **потокового импорта**.
При этом объемы импорта имеют тенденцию к увеличению.
Тестирование потоковой нагрузки с применением накопительного буфера (для выравнивания неравномерной нагрузки с явлениями пикового характера) выявило проблему ее невысокой передельной масштабируемости на этапе конечной вставки.
Здесь проблемой явились как осоенности реляционной базы (взаимоблокировки параллельных потоков в рамках сессии на PK), так и размеры самой конечной структуры и наличие огромного количества вспомогательных индексов, конкурирующие процессы, работающие с той же конечной структурой.

#### Итого
> Количество импортируемых данных растет, имея тенденцию к потоковому импорту.
> При этом мы имеем относительно невысокую предельную масштабируемость на вставку из-за неприспособленности для этого реляционной структуры (PK).
> Но, тем не менее, обеспечение целостности данных в рамках реляционной модели для нас сохраняет актуальность.

## Аналитика
Система делает аналитические расчеты в целом двух типов.
### Оперативные аналитические расчеты
Оперативыне расчеты затрагивают небольшой срез свежих данных, но имеют сложную логику и существуют в большом количестве кейсов.
К оперативным расчетам можно отнести **расчет комплексных** КВП и расчеты КВП, выполняемыми **сервисными процедурами**.
Все расчеты делаются аснхронно по расписанию, но появление итоговых КВП относительно критично по времени.
### Система отчетности
Есть отчеты с достаточно **нагруженной логикой**, с применением pivot и различными эксцентриками.
Здесь с большой вероятностью требуются предрасчетные данные (витрины).
### Дашборды
Пилот реализован на одной из площадок на Mobile Reports. 
Платформа не имеет особого значения, возможен вариант с Power BI и другими инструментами.
Логика здесь не сложная, но критичен **отклик**.
Явно необходима оперативно пополняемая витрина с зачисткой исторических данных.

#### Итого
> Система имеет блок аналитики в зачаточном виде, но есть перспектива и интерес клиентов к раширению функциональности в данном направлении.
> Направление развития скорее имеет тенденцию к оперативной аналитике, но предрасчетный вариант в перспективе не исключен полностью.

## Логирование
Есть стандартное логирование в таблицу базы, выполняемое из процедур.
Но логирование идет ограниченно, в основном по ошибкам.
Было бы неплохо логировать связанные процессы подробно, не тормозя при этом основной рабочий процесс.
Видимо здесь будет неплохо сделать систему **асинхронного логирования** с таймстампами.
Разумеется актуальна тема зачистки исторических данных.

#### Итого
> Необходим вариант с неструктурироанной массовой вставкой с хорошей пропускной способностью.

## Клиентская часть
### Стандартный клиент
Не факт что уходит в прошлое. Иногда требуется обработка/промотр больших объемов данных.
И это не сильная сторона тонкого клиента.
Основным недостатком здесь является реализация логики **запроса по факту**.
эти запросы могут быть как легковесными, так и нагруженными.
Но их количество может быть запредельным в сумме.
Здесь проблема блокировок и ошибок оптимизатора в оценке статистики данных.
Также есть проблемы с кэшированием и обновлением данных, глушением ошибок при взаимодействии с базой данных.

### Тонкий клиент
Традиционно критичен отклик. Проблема пагинации с учетом динамического обновления данных.

#### Итого
> Необходимо выделение оперативных данных и, возможно, ревизия клиентской логики.

## Фильтрация
Центральный компонент, задействованный во многих сервисах.
В тонком клиенте трансформирован в динамический конструктор, работающий от заданных на входе параметров.
Но суть остается прежней.
Для того, чтобы дофильтровать данные, мы изначально должны пройтись по **большому исходному набору очень широкой перегруженной таблицы**.
Стандартная проблема ERP систем с горизонтальным набором КВП.
При этом именно тут нам требуется максимально мгновенный отклик.

#### Итого
> Требуются горизонтальная реструктуризация и изменение идеологии фильтрации.
> При реструктуризации максимально критична проблема объединений.

